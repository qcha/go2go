# Concurrency

## Условие

Что выведет следующий код:

```go
func main() {
    for _, val := range []int{1, 2, 3} {
        go println(val)
    }
}
```

Поправьте его, чтобы было правильно.

## Решение

Программа скорее всего ничего не выведет на экран, так как программа завершится не дождавшись завершения всех запущенных горутин (или они не успеют стартовать даже).

Чтобы дождаться завершения всех горутин необходимо использовать WaitGroup.

```go
func main() {
    wg := sync.WaitGroup{}
    for _, val := range []int{1, 2, 3} {
        wg.Add(1)
        go func(val int) {
            defer wg.Done()

            println(val)
        }(val)
    }

    wg.Wait()
}
```

При этом вывод будет недетерминированный.

Важно: этот код будет работать для Go 1.22 и выше, так как там был переделан механизм захвата переменной.
Подробнее про это разбиралось в [похожей задаче](./closure_in_for.md).
